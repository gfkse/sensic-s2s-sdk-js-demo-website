<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>YouTube VOD Demo</title>
  <link rel='shortcut icon' href='../../../images/favicon.png' />
  <link rel='stylesheet' href='../../../css/s2s-demo.css' />
  <link rel='stylesheet' href='../../../css/youtubeVideo.css'>
  <script src='../../../js/url-polyfill.js'></script>
  <script type='module' src='../../../js/optin-box.js'></script>
  <script type='module' src='../../../js/tcf-box.js'></script>
</head>
<body>
<script src='../../../js/optin-params.js'></script>

<script>
// In case questions about the optin parameter, please read the documentation: https://confluence-docu.gfk.com/display/SENSIC/Javascript+SDK+Integration
// Read more about privacy:https://confluence-docu.gfk.com/pages/viewpage.action?pageId=13043961
var gfkS2sConf = {
  optin: optin,
  media: 's2s-youtube-demo',
  url: window.env.WEB_SDK_URL,
  type: 'WEB',
  logLevel: 'debug'
};
</script>
<optin-box></optin-box>
<tcf-box></tcf-box>
<!-- The following <div> tag will be replaced by an <iframe> tag with same id and youtube.com URL. -->
<div id='my_player_id'></div>

<script>
var youtubeVideoId = '4TFKZFg5ko4';
var tag = document.createElement('script');
tag.src = 'https://www.youtube.com/iframe_api';
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var video = document.getElementById('my_player_id');
var player;
var playerConf;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('my_player_id', {
    videoId: youtubeVideoId,
    events: {
      'onReady': initExtension
    }
  });
  playerConf = {
    instance: player,
    vendor: 'youtube'
  };
}

</script>

<script>
var extension;
var contentMetadata = {customParams : {}};
var script = document.createElement('script');
// this part is needed for the YouTube embedded example
// from here
var isEmbeddedVideoUrl = (window.location !== window.parent.location) ? document.referrer : document.location.href;
var cp1 = isEmbeddedVideoUrl.match(/^(https?:\/\/)?(www\.)?([^\/]+)/)[3].split('.').slice(0, -1).join('.');
// to here
var contentMetadata = {
  customParams: {
    cp1: cp1
  }
};

function initExtension(event) {
  script.src = `${window.env.EXTENSION_BASE_URL}/playerextension.js`;
  document.head.appendChild(script);

  script.onload = function() {
    // for more information, see: https://confluence-docu.gfk.com/pages/viewpage.action?pageId=102334502
    extension = new window.gfkS2sExtension.PlayerExtension(playerConf, gfkS2sConf, contentMetadata);

    // call setParameter() as soon as your player is switching over to different content. Otherwise, new content will be
    // reported with parameters of the video played before.
    // extension.setParameter({customParams: { cp1: '<your new cp1 value here>', cp2: '<your new cp2 value here>', ... } , contentId: 'news'});

  };
}
</script>
</body>
</html>
